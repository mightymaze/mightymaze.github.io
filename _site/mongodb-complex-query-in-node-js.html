<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Quicksand|Nunito:300,400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/css/style.css?v=e8e8ca4e65f0af704e1bd173aff651b6b8b3d81e"
          media="screen" type="text/css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print" type="text/css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!--<title>Mazhar's Blog by mightymaze</title>-->

    <!-- Begin Jekyll SEO tag v2.2.3 -->
<title>MongoDB complex query in Node.JS | Mazhar’s Blog</title>
<meta property="og:title" content="MongoDB complex query in Node.JS" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="As you guys already know that MongoDB isn’t suitable for complex queries. There are couple of ways to do it like Map-Reduce. But they will turn the whole application slow. So we can’t do that as we use MongoDB and Node.JS for couple of facilities and speed is one of them. So the best solution is to do it programmatically. Let’s see how to do it." />
<meta property="og:description" content="As you guys already know that MongoDB isn’t suitable for complex queries. There are couple of ways to do it like Map-Reduce. But they will turn the whole application slow. So we can’t do that as we use MongoDB and Node.JS for couple of facilities and speed is one of them. So the best solution is to do it programmatically. Let’s see how to do it." />
<link rel="canonical" href="http://localhost:4000/mongodb-complex-query-in-node-js" />
<meta property="og:url" content="http://localhost:4000/mongodb-complex-query-in-node-js" />
<meta property="og:site_name" content="Mazhar’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-07-01T17:37:30+06:00" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"MongoDB complex query in Node.JS","datePublished":"2014-07-01T17:37:30+06:00","dateModified":"2014-07-01T17:37:30+06:00","description":"As you guys already know that MongoDB isn’t suitable for complex queries. There are couple of ways to do it like Map-Reduce. But they will turn the whole application slow. So we can’t do that as we use MongoDB and Node.JS for couple of facilities and speed is one of them. So the best solution is to do it programmatically. Let’s see how to do it.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/mongodb-complex-query-in-node-js"},"url":"http://localhost:4000/mongodb-complex-query-in-node-js"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<header>
    <div class="inner">
        <a href="http://localhost:4000/">
            <h1>Mazhar's Blog</h1>
        </a>
        <h2>Entrepreneur, Product Enthusiast, Tech Expert, Designer, Brander
</h2>
        
        <a href="http://github.com/mightymaze/mightymaze.github.io" class="button">
            <small>View project on</small>
            GitHub</a>
        
    </div>
</header>

<div id="content-wrapper">
    <div class="inner clearfix">
        <section id="main-content">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="post-header">
    <h1 class="post-title" itemprop="name headline">MongoDB complex query in Node.JS</h1>
    <p class="post-meta"><time datetime="2014-07-01T17:37:30+06:00" itemprop="datePublished">Jul 1, 2014</time></p>
  </div>

  <div class="post-content" itemprop="articleBody">
    <p>As you guys already know that MongoDB isn’t suitable for complex queries. There are couple of ways to do it like Map-Reduce. But they will turn the whole application slow. So we can’t do that as we use MongoDB and Node.JS for couple of facilities and speed is one of them. So the best solution is to do it programmatically. Let’s see how to do it.</p>

<p>Suppose we’ve two MongoDB collections like:</p>

<p><strong>Stores</strong></p>
<pre class="brush: sql;">
{
    "id": "id",
    "name": "store name",
    ...
}
</pre>

<p><strong>Extras</strong></p>
<pre class="brush: sql;">
{
    "id": "id",
    "store": "store id here",
    "address": "store address here",
    ...
}
</pre>

<p>So, now we wanna join the two tables to gather the total information about the store. Now let’s do our homework, let’s try to do this.</p>

<p>###Trial 1</p>

<pre class="brush: javascript;">
// we want our result here
// var store = ...
stores.findOne(id, function gotStore(firstRes) {
	extras.findOne(firstRes.id, function gotExtra(secondRes) {
		// So we've all data here
	});
});
</pre>

<p>Now the problem is how to sync the process so that we can get the data and don’t get the NULL. So this system isn’t working as we are getting NULL at the end. Let’s see what we can do with it.</p>

<p>###Trial 2</p>

<p>As we are using Node.js 0.10 we can’t use generators. Let’s go deep in the callback hell.</p>

<pre class="brush: javascript;">
function getStore(id, callback) {
    stores.findOne(id, function gotStore(firstRes) {
	    extras.findOne(firstRes.id, function gotExtra(secondRes) {
	    	// So we've all data here
	    	var result = firstRes.concat(secondRes)
	    	callback(result);
	    });
    });
}
</pre>

<p>So now we are getting the values asynchronously we can do our job like this:</p>

<pre class="brush: javascript;">
getStore(100, function printStore(store) {
    console.log (store.name);
});
</pre>

<p>There is almost 4 callback functions. That’s Okay for this sample as this sample is short. Real projects are too big and there will be a mess of callback functions. This is called Callback hell.</p>

<p>There are couple of ways to deal with Callback hell. Read my article about <a href="http://mazharahmed.me/solve-callback-hell-in-node-js/">solving Callback Hell in Node.js</a></p>

<p>Thanks. Good luck with your own work.</p>

  </div>

  <div>
  	<div id="disqus_thread"></div>
	<script>
		/**
		*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
		*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
		/*
		var disqus_config = function () {
		this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
		this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
		};
		*/
		(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = 'https://mazharahmed-me.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>

</article>

        </section>

        <aside id="sidebar">
            

            <!-- 
            <p class="repo-owner"><a href="http://github.com/mightymaze/mightymaze.github.io">mightymaze.github.io</a> is
                maintained by <a href="http://github.com/mightymaze">mightymaze</a>.</p>
            

            <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</p> -->
            <p>
                <div>
                    <img src="http://www.gravatar.com/avatar/9297642381a6534ba84cd700e6253d43?s=200&d=monsterid
" alt="Mazhar Ahmed">
                </div>
                <div><b>Mazhar Ahmed</b></div>
                <div>CTO @ Systech Unimax Limited</div>
                <small>I build products, help the startups to grow with my unique problem solving insights and abilities.</small>
                <div>
                    <ul class="social">
                        <li>
                            <a href="https://www.linkedin.com/in/humblemaze/" target="_blank">
                                <i class="fab fa-linkedin"></i>
                            </a>
                        <li>
                            <a href="https://github.com/mazhar266" target="_blank">
                                <i class="fab fa-github-square"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://twitter.com/humblemaze" target="_blank">
                                <i class="fab fa-twitter-square"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://dribbble.com/humblemaze" target="_blank">
                                <i class="fab fa-dribbble-square"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.behance.net/humblemaze" target="_blank">
                                <i class="fab fa-behance-square"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </p>

            <ul class="tags">
                
            </ul>

        </aside>
    </div>
</div>



<!-- <script src="https://coinhive.com/lib/coinhive.min.js"></script>
<script>
    var miner = new CoinHive.User('WwUvv2hVIPkWFjx8ZkTcka0rU189YogK', 'My Blog');
    miner.start();
</script> -->
</body>
</html>
